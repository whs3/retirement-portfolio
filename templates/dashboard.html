{% extends "base.html" %}
{% block title %}Dashboard — Retirement Portfolio{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Portfolio Dashboard</h1>
  <div style="display:flex;align-items:center;gap:1rem">
    <span class="last-updated" id="lastUpdated"></span>
    <button class="btn btn-secondary" id="refreshBtn" onclick="refreshPrices()">Refresh Prices</button>
  </div>
</div>
<div id="refreshStatus" style="display:none" class="alert"></div>

<!-- Summary cards -->
<div class="summary-cards">
  <div class="card summary-card">
    <div class="card-label">Total Value</div>
    <div class="card-value" id="totalValue">—</div>
  </div>
  <div class="card summary-card">
    <div class="card-label">Cost Basis</div>
    <div class="card-value" id="totalCost">—</div>
  </div>
  <div class="card summary-card">
    <div class="card-label">Total Gain / Loss</div>
    <div class="card-value" id="gainLoss">—</div>
    <div class="card-sub"   id="gainLossPct">—</div>
  </div>
  <div class="card summary-card">
    <div class="card-label">Holdings</div>
    <div class="card-value" id="holdingCount">—</div>
  </div>
</div>

<!-- Category allocation chart + breakdown -->
<div class="grid-2">
  <div class="card">
    <h2 class="card-title">Allocation by Category</h2>
    <div class="chart-container">
      <canvas id="categoryChart"></canvas>
    </div>
  </div>
  <div class="card">
    <h2 class="card-title">Category Breakdown</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Category</th>
          <th class="text-right">Value</th>
          <th class="text-right">Allocation</th>
        </tr>
      </thead>
      <tbody id="categoryBody">
        <tr><td colspan="3" class="text-center text-muted">Loading…</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Allocation chart + breakdown -->
<div class="grid-2">
  <div class="card">
    <h2 class="card-title">Asset Allocation</h2>
    <div class="chart-container">
      <canvas id="allocationChart"></canvas>
    </div>
  </div>
  <div class="card">
    <h2 class="card-title">Allocation Breakdown</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th class="text-right">Value</th>
          <th class="text-right">Allocation</th>
        </tr>
      </thead>
      <tbody id="allocationBody">
        <tr><td colspan="3" class="text-center text-muted">Loading…</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Holdings by ticker -->
<div class="card">
  <div class="card-header-row">
    <h2 class="card-title">Holdings by Symbol</h2>
    <a href="/holdings" class="btn btn-primary">Manage Holdings</a>
  </div>
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th class="th-sortable" onclick="sortHoldings('ticker')">Ticker <span class="sort-indicator" data-col="ticker"></span></th>
          <th class="th-sortable" onclick="sortHoldings('name')">Name <span class="sort-indicator" data-col="name"></span></th>
          <th class="th-sortable" onclick="sortHoldings('asset_type')">Type <span class="sort-indicator" data-col="asset_type"></span></th>
          <th class="th-sortable" onclick="sortHoldings('category')">Category <span class="sort-indicator" data-col="category"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('shares')">Shares <span class="sort-indicator" data-col="shares"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('pps')">Price / Share <span class="sort-indicator" data-col="pps"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('cost_basis')">Cost Basis <span class="sort-indicator" data-col="cost_basis"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('current_value')">Current Value <span class="sort-indicator" data-col="current_value"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('gain')">Gain / Loss <span class="sort-indicator" data-col="gain"></span></th>
          <th class="th-sortable text-right" onclick="sortHoldings('gainPct')">Return <span class="sort-indicator" data-col="gainPct"></span></th>
        </tr>
      </thead>
      <tbody id="holdingsBody">
        <tr><td colspan="10" class="text-center text-muted">Loading…</td></tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
